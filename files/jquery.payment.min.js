(function(){var d,k,m,j,f,n,p,q,r,s,t,l,u,v,w,x,y,z,A,C=[].slice,B=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};d=jQuery;d.payment={};d.payment.fn={};d.fn.payment=function(){var a,b;b=arguments[0];a=2<=arguments.length?C.call(arguments,1):[];return d.payment.fn[b].apply(this,a)};f=/(\d{1,4})/g;j=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:f,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",
pattern:/^(36|38|30[0-5])/,format:f,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:f,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:f,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:f,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:f,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:f,length:[16],cvcLength:[3],luhn:!0},{type:"amex",
pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:f,length:[13,14,15,16],cvcLength:[3],luhn:!0}];k=function(a){var b,c,e;a=(a+"").replace(/\D/g,"");c=0;for(e=j.length;c<e;c++)if(b=j[c],b.pattern.test(a))return b};m=function(a){var b,c,e;c=0;for(e=j.length;c<e;c++)if(b=j[c],b.type===a)return b};u=function(a){var b,c,e,d,g;c=!0;e=0;b=(a+"").split("").reverse();d=0;for(g=b.length;d<g;d++){a=b[d];a=parseInt(a,10);if(c=!c)a*=2;
9<a&&(a-=9);e+=a}return 0===e%10};l=function(a){var b;return null!=a.prop("selectionStart")&&a.prop("selectionStart")!==a.prop("selectionEnd")||"undefined"!==typeof document&&null!==document&&null!=(b=document.selection)&&"function"===typeof b.createRange&&b.createRange().text?!0:!1};v=function(a){return setTimeout(function(){var b,c;b=d(a.currentTarget);c=b.val();c=d.payment.formatCardNumber(c);return b.val(c)})};q=function(a){var b,c,e,f,g,h;e=String.fromCharCode(a.which);if(/^\d+$/.test(e)&&(b=
d(a.currentTarget),h=b.val(),c=k(h+e),f=(h.replace(/\D/g,"")+e).length,g=16,c&&(g=c.length[c.length.length-1]),!(f>=g)&&!(null!=b.prop("selectionStart")&&b.prop("selectionStart")!==h.length))){c=c&&"amex"===c.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/;if(c.test(h))return a.preventDefault(),b.val(h+" "+e);if(c.test(h+e))return a.preventDefault(),b.val(h+e+" ")}};n=function(a){var b,c;b=d(a.currentTarget);c=b.val();if(!a.meta&&!(null!=b.prop("selectionStart")&&b.prop("selectionStart")!==c.length)&&
8===a.which&&/\s\d?$/.test(c))return a.preventDefault(),b.val(c.replace(/\s\d?$/,""))};r=function(a){var b,c;c=String.fromCharCode(a.which);if(/^\d+$/.test(c)){b=d(a.currentTarget);c=b.val()+c;if(/^\d$/.test(c)&&"0"!==c&&"1"!==c)return a.preventDefault(),b.val("0"+c+" / ");if(/^\d\d$/.test(c))return a.preventDefault(),b.val(""+c+" / ")}};s=function(a){var b;b=String.fromCharCode(a.which);if(/^\d+$/.test(b)&&(a=d(a.currentTarget),b=a.val(),/^\d\d$/.test(b)))return a.val(""+b+" / ")};t=function(a){var b;
if("/"===String.fromCharCode(a.which)&&(a=d(a.currentTarget),b=a.val(),/^\d$/.test(b)&&"0"!==b))return a.val("0"+b+" / ")};p=function(a){var b,c;if(!a.meta&&(b=d(a.currentTarget),c=b.val(),8===a.which&&!(null!=b.prop("selectionStart")&&b.prop("selectionStart")!==c.length)&&/\s\/\s?\d?$/.test(c)))return a.preventDefault(),b.val(c.replace(/\s\/\s?\d?$/,""))};z=function(a){if(a.metaKey||a.ctrlKey)return!0;if(32===a.which)return!1;if(0===a.which||33>a.which)return!0;a=String.fromCharCode(a.which);return!!/[\d\s]/.test(a)};
x=function(a){var b;b=d(a.currentTarget);a=String.fromCharCode(a.which);if(/^\d+$/.test(a)&&!l(b))return a=(b.val()+a).replace(/\D/g,""),(b=k(a))?a.length<=b.length[b.length.length-1]:16>=a.length};y=function(a){var b;b=d(a.currentTarget);a=String.fromCharCode(a.which);if(/^\d+$/.test(a)&&!l(b)&&(b=b.val()+a,b=b.replace(/\D/g,""),6<b.length))return!1};w=function(a){var b;b=d(a.currentTarget);a=String.fromCharCode(a.which);if(/^\d+$/.test(a))return b=b.val()+a,4>=b.length};A=function(a){var b,c;a=
d(a.currentTarget);b=a.val();c=d.payment.cardType(b)||"unknown";if(!a.hasClass(c)){var e,f,g;g=[];e=0;for(f=j.length;e<f;e++)b=j[e],g.push(b.type);a.removeClass("unknown");a.removeClass(g.join(" "));a.addClass(c);a.toggleClass("identified","unknown"!==c);return a.trigger("payment.cardType",c)}};d.payment.fn.formatCardCVC=function(){this.payment("restrictNumeric");this.on("keypress",w);return this};d.payment.fn.formatCardExpiry=function(){this.payment("restrictNumeric");this.on("keypress",y);this.on("keypress",
r);this.on("keypress",t);this.on("keypress",s);this.on("keydown",p);return this};d.payment.fn.formatCardNumber=function(){this.payment("restrictNumeric");this.on("keypress",x);this.on("keypress",q);this.on("keydown",n);this.on("keyup",A);this.on("paste",v);return this};d.payment.fn.restrictNumeric=function(){this.on("keypress",z);return this};d.payment.fn.cardExpiryVal=function(){return d.payment.cardExpiryVal(d(this).val())};d.payment.cardExpiryVal=function(a){var b,c;a=a.replace(/\s/g,"");b=a.split("/",
2);a=b[0];c=b[1];if(2===(null!=c?c.length:void 0)&&/^\d+$/.test(c))b=(new Date).getFullYear(),b=b.toString().slice(0,2),c=b+c;a=parseInt(a,10);c=parseInt(c,10);return{month:a,year:c}};d.payment.validateCardNumber=function(a){var b,c;a=(a+"").replace(/\s+|-/g,"");if(!/^\d+$/.test(a))return!1;b=k(a);return!b?!1:(c=a.length,0<=B.call(b.length,c))&&(!1===b.luhn||u(a))};d.payment.validateCardExpiry=function(a,b){var c,e;"object"===typeof a&&"month"in a&&(c=a,a=c.month,b=c.year);if(!a||!b)return!1;a=d.trim(a);
b=d.trim(b);if(!/^\d+$/.test(a)||!/^\d+$/.test(b)||!(12>=parseInt(a,10)))return!1;2===b.length&&(c=(new Date).getFullYear(),c=c.toString().slice(0,2),b=c+b);e=new Date(b,a);c=new Date;e.setMonth(e.getMonth()-1);e.setMonth(e.getMonth()+1,1);return e>c};d.payment.validateCardCVC=function(a,b){var c,e;a=d.trim(a);return!/^\d+$/.test(a)?!1:b?(c=a.length,0<=B.call(null!=(e=m(b))?e.cvcLength:void 0,c)):3<=a.length&&4>=a.length};d.payment.cardType=function(a){var b;return!a?null:(null!=(b=k(a))?b.type:void 0)||
null};d.payment.formatCardNumber=function(a){var b,c,d;b=k(a);if(!b)return a;c=b.length[b.length.length-1];a=a.replace(/\D/g,"");a=a.slice(0,+c+1||9E9);if(b.format.global)return null!=(d=a.match(b.format))?d.join(" "):void 0;a=b.format.exec(a);null!=a&&a.shift();return null!=a?a.join(" "):void 0}}).call(this);
